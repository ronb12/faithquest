<!-- Full FaithQuest Code continued -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyAWT0pDA0Rqv9GI8wVgAOZKakpydjTI6z4",
  authDomain: "faithquest-1a124.firebaseapp.com",
  projectId: "faithquest-1a124",
  storageBucket: "faithquest-1a124.appspot.com",
  messagingSenderId: "680483549913",
  appId: "1:680483549913:web:e8b89d00d7add3540284c8"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();
let currentUser = null;
auth.signInAnonymously().then(res => currentUser = res.user);

function loadTheme() {
  const saved = localStorage.getItem("theme") || "default";
  setTheme(saved);
}
function setTheme(theme) {
  document.body.style.background =
    theme === "dark" ? "#121212" :
    theme === "ocean" ? "linear-gradient(to bottom, #0088cc, #004466)" :
    "linear-gradient(to bottom, #f9f9f9, #e0eafc)";
}
function capitalize(word) {
  return word.charAt(0).toUpperCase() + word.slice(1);
}
function renderAvatar() {
  const avatar = localStorage.getItem("avatar") || "seeker";
  const mini = document.getElementById("avatarMini");
  const final = document.getElementById("avatarFinal");
  const img = `<img src='avatars/${avatar}.png' alt='avatar' style='width:32px;height:32px;border-radius:50%;'>`;
  mini.innerHTML = img;
  final.innerHTML = img;
}
function showIntro() {
  const avatar = localStorage.getItem("avatar") || "seeker";
  const xp = parseInt(localStorage.getItem("totalXP") || '0');
  const level = Math.floor(xp / 100) + 1;
  document.getElementById("introAvatar").innerHTML = `<img src='avatars/${avatar}.png' style='width:64px;height:64px;border-radius:50%;'>`;
  document.getElementById("introDetails").innerHTML = `<p><strong>Level ${level}</strong> ${capitalize(avatar)}</p><p>Total XP: ${xp}</p>`;
  document.getElementById("difficulty-select").style.display = "none";
  document.getElementById("introScreen").style.display = "block";
}
function proceedToDifficulty() {
  document.getElementById("introScreen").style.display = "none";
  document.getElementById("difficulty-select").style.display = "block";
}

let questions = [], current = 0, lives = 3, xp = 0, xpPerCorrect = 10, difficulty = "easy";
const easy = [...]; // Add easy question objects
const medium = [...]; // Add medium question objects
const hard = [...]; // Add hard question objects

function startGame(level) {
  difficulty = level;
  questions = shuffle(level === "easy" ? easy : level === "medium" ? medium : hard);
  xpPerCorrect = level === "easy" ? 10 : level === "medium" ? 15 : 25;
  lives = 3;
  xp = 0;
  current = 0;
  document.getElementById("lives").textContent = lives;
  document.getElementById("xp").textContent = xp;
  document.getElementById("difficulty-select").style.display = "none";
  document.getElementById("game").style.display = "block";
  showQuestion();
}
function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}
function showQuestion() {
  if (current >= questions.length || lives <= 0) return endGame();
  const q = questions[current];
  document.getElementById("question").textContent = q.question;
  const optionsEl = document.getElementById("options");
  optionsEl.innerHTML = '';
  document.getElementById("explanation").textContent = '';
  q.options.forEach(opt => {
    const btn = document.createElement("div");
    btn.className = "option";
    btn.textContent = opt;
    btn.onclick = () => checkAnswer(opt, btn, q.answer, q.explanation);
    optionsEl.appendChild(btn);
  });
}
function checkAnswer(selected, btn, correct, explanation) {
  if (selected === correct) {
    btn.classList.add("correct");
    xp += xpPerCorrect;
    document.getElementById("xp").textContent = xp;
  } else {
    btn.classList.add("incorrect");
    lives--;
    document.getElementById("lives").textContent = lives;
  }
  document.getElementById("explanation").textContent = explanation;
  setTimeout(() => { current++; showQuestion(); }, 1600);
}
async function endGame() {
  document.getElementById("game").style.display = "none";
  document.getElementById("game-over").style.display = "block";
  document.getElementById("final-xp").textContent = xp;
  const name = prompt("Enter your name for the leaderboard:");
  const avatar = localStorage.getItem("avatar") || "seeker";
  if (name && currentUser) {
    await db.collection("leaderboard").add({
      uid: currentUser.uid,
      name: name,
      xp: xp,
      difficulty: difficulty,
      avatar: avatar,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });
  }
  showLeaderboard();
}
async function showLeaderboard() {
  const snap = await db.collection("leaderboard")
    .orderBy("xp", "desc")
    .limit(5)
    .get();
  const leaderboardEl = document.getElementById("leaderboard");
  leaderboardEl.innerHTML = "<h3>üèÜ Top 5 Leaderboard</h3>";
  snap.forEach(doc => {
    const data = doc.data();
    const avatar = data.avatar || "seeker";
    leaderboardEl.innerHTML += `
      <div style='display:flex;align-items:center;margin-bottom:0.5em;'>
        <img src='avatars/${avatar}.png' style='width:32px;height:32px;border-radius:50%;margin-right:10px;'>
        <span>${data.name} (${data.difficulty}): ${data.xp} XP</span>
      </div>`;
  });
}
window.onload = () => {
  loadTheme();
  const soundPref = localStorage.getItem("soundPack") || "classic";
  loadSoundFiles(soundPref);
  renderAvatar();
  showIntro();
};
</script>
